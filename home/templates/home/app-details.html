{% extends "home/base.html" %}
{% load static %}

{% block title %}
    OneTable - {{ app.name }}
{% endblock %}

{% block headername %}
  {{ app.name }}
{% endblock %}

{% block topbar %}
  {% include "home/app-header.html" %}
{% endblock %}

{% block content %}

<p>App details works!</p>

{% endblock %}

{% block extrajs %}
<script>
  // Get dashboard page 1
  (function($) {
    $('#activity').on('click', function(e) {
        e.preventDefault();
        $.ajax({
            type: "POST",
            url: "{% url 'activity' organization_pk=organization.pk app_pk=app.pk %}",
            data: {
                'csrfmiddlewaretoken': window.CSRF_TOKEN // from index.html
            },
            success: function(data) {
                // append html to the posts div
                $('#main-content').html(data.html);
            },
            error: function(xhr, status, error) {
                // shit happens friends!
            }
        });
    });
  }(jQuery));

  // Get dashboard page 2
  (function($) {
    $('#tasks').on('click', function(e) {
        e.preventDefault();
        $.ajax({
          type: "POST",
          url: "{% url 'tasks' organization_pk=organization.pk app_pk=app.pk %}",
            data: {
                'csrfmiddlewaretoken': window.CSRF_TOKEN // from index.html
            },
            success: function(data) {
                // append html to the posts div
                $('#main-content').html(data.html);
            },
            error: function(xhr, status, error) {
                // shit happens friends!
            }
        });
    });
  }(jQuery));

  // Get dashboard page 3
  (function($) {
    $('#notes').on('click', function(e) {
        e.preventDefault();
        $.ajax({
          type: "POST",
          url: "{% url 'notes' organization_pk=organization.pk app_pk=app.pk %}",
            data: {
                'csrfmiddlewaretoken': window.CSRF_TOKEN // from index.html
            },
            success: function(data) {
                // append html to the posts div
                $('#main-content').html(data.html);
            },
            error: function(xhr, status, error) {
                // shit happens friends!
            }
        });
    });
  }(jQuery));

  // Get dashboard page 3
  (function($) {
    $('#addMenu').on('click', function(e) {
        e.preventDefault();
        // Show the input box
        $('#addMenuInput').removeClass('d-none')
    });
  }(jQuery));

  // Get dashboard page 3
  (function($) {
    $('#saveMenu').on('click', function(e) {
        e.preventDefault();
        // Show the input box

        // Get form fields
        var menu_name = $('input[name=menuName]').val();

        // Validate form fields
        if (menu_name != "") {
          // Send in the request
          var formData = {
              'menu_name': menu_name,
              'csrfmiddlewaretoken': window.CSRF_TOKEN
          };

          // process the form
          $.ajax({
              type: "POST",
              url: "{% url 'add_menu' organization_pk=organization.pk app_pk=app.pk %}",
              data: formData,
              dataType: "json",
              encode: true
          }).done(function(data) {

              console.log(data)
              $('#menu-lists').html(data['html_from_view'])
              $('#menuName').val("")

          }).fail(function(xhr, status, error) {
            //Ajax request failed.
            var errorMessage = xhr.status + ': ' + xhr.statusText
            alert('Error - ' + errorMessage);

          });

          return false;

       } else {

         // The user provided an empty value, show form error
       }
    });
  }(jQuery));

</script>
{% endblock %}
